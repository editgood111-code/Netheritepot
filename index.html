<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Netheritepot Tierlist</title>
<style>
:root { --bg:#0d1117; --card:#161b22; --muted:#9aa; --accent:#238636; --accent-hover:#2ea043; }
body { margin:0; font-family:Arial,sans-serif; background:var(--bg); color:#c9d1d9; padding:20px; text-align:center; }
h1 { color:#ffcc00; margin-bottom:20px; }

/* Search */
.search-wrap { display:flex; justify-content:center; gap:8px; margin-bottom:14px; align-items:center; }
.search-wrap input { width:240px; padding:8px 10px; border-radius:6px; background:var(--card); border:1px solid #30363d; color:#c9d1d9; }
.search-wrap button { padding:8px 12px; border-radius:6px; border:none; background:var(--accent); color:#fff; cursor:pointer; }
.search-wrap button:hover { background:var(--accent-hover); }

#search-result { display:flex; justify-content:center; gap:12px; flex-wrap:wrap; margin-bottom:16px; }
.mini-card { background:var(--card); border:1px solid #30363d; border-radius:10px; padding:12px; width:220px; display:flex; flex-direction:column; align-items:center; gap:6px; }
.mini-card img.skin { width:64px; height:64px; border-radius:8px; border:2px solid #fff; object-fit:cover; }
.mini-card .region { color:var(--muted); font-size:13px; }
.mini-card .name { font-weight:700; font-size:16px; overflow-wrap:anywhere; }
.mini-card .tier-box { display:flex; align-items:center; gap:8px; background:#212526; padding:6px 10px; border-radius:8px; font-weight:700; }
.mini-card .tier-box img { width:22px; height:22px; }
.mini-card .alias-note { font-size:12px; color:#ffd; border-radius:4px; margin-top:4px; text-align:center; }
.mini-card .namemc { color:#6f9bff; text-decoration:none; font-size:13px; }

/* Add Player UI */
.add-wrap { margin-top:20px; display:flex; justify-content:center; gap:8px; }
.add-wrap input { width:220px; padding:8px 10px; border-radius:6px; background:var(--card); border:1px solid #30363d; color:#c9d1d9; }
.add-wrap button { padding:8px 12px; background:var(--accent); border:none; border-radius:6px; color:white; cursor:pointer; }
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
<h1>Netheritepot Tierlist</h1>

<!-- Search -->
<div class="search-wrap">
  <input id="search-input" placeholder="Search player...">
  <button onclick="searchPlayer()">Search</button>
</div>
<div id="search-result"></div>

<!-- Add Player -->
<div class="add-wrap">
  <input id="add-username" placeholder="Add player username...">
  <button onclick="addPlayer()">Add</button>
</div>

<script>
const playersRef = firebase.database().ref('players');
let players = [];
let pendingPremiumCheck = null;

function getHeadURL(name,type='premium',size=32){ return type==='premium'?`https://mc-heads.net/avatar/${encodeURIComponent(name)}/${size}`:`https://mc-heads.net/avatar/Steve/${size}`; }

playersRef.on('value',snap=>{
  const data=snap.val();
  players = data ? (Array.isArray(data) ? data : Object.values(data)) : [];
});

/* SEARCH PLAYER */
function searchPlayer(){
  const q=(document.getElementById('search-input').value||'').trim().toLowerCase();
  const resDiv=document.getElementById('search-result'); resDiv.innerHTML='';
  if(!q){ alert('Type a player name first.'); return; }

  const found = players.find(p=>p.name.toLowerCase()===q || (p.aliases||[]).some(a=>a.toLowerCase()===q));

  if(found){
    const card=document.createElement('div'); card.className='mini-card';
    const aliasNote = ((found.aliases||[]).map(a=>a.toLowerCase()).includes(q) && q!==found.name.toLowerCase()) ? `<div class="alias-note">Searched an old name. Current IGN: ${found.name}</div>` : '';

    card.innerHTML=`
      <img class="skin" src="${found.skin||getHeadURL(found.name,found.type,64)}">
      <div class="region">${found.region}</div>
      <div class="name">${found.name}</div>
      ${found.type==='premium'?`<a class="namemc" href="https://namemc.com/profile/${encodeURIComponent(found.name)}" target="_blank">NameMC</a>`:''}
      <div class="tier-box"><img src="https://mctiers.com/tier_icons/nethop.svg"><div>${found.tier}</div></div>
      ${aliasNote}
    `;
    resDiv.appendChild(card);
  } else { alert('Player not found in leaderboard.'); }
}

/* ADD PLAYER WITH PREMIUM USERNAME CHANGE WARNING */
async function addPlayer(){
  let username = document.getElementById('add-username').value.trim();
  if(!username){ alert('Type a username first.'); return; }

  let apiName = await fetch(`https://api.mojang.com/users/profiles/minecraft/${username}`)
      .then(res=>res.ok?res.json():null)
      .catch(()=>null);

  if(apiName && apiName.name !== username){
      pendingPremiumCheck = { old: username, now: apiName.name };

      let ask = confirm(`âš  Username Change Detected!

Old Username: ${username}
New Premium Username: ${apiName.name}

Continue with NEW name?`);
      if(!ask){ pendingPremiumCheck=null; return; }

      username = apiName.name;
      pendingPremiumCheck=null;
  }

  const newPlayer = {
    name: username,
    type: apiName ? 'premium' : 'cracked',
    region: 'Unknown',
    aliases: [],
    skin: getHeadURL(username, apiName?'premium':'cracked',64),
    tier: 'Unranked'
  };

  players.push(newPlayer);
  playersRef.set(players);
  document.getElementById('add-username').value='';
  alert('Player added successfully.');
}
</script>
</body>
</html>
