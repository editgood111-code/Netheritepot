<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NetheritePot | Rankings</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-app: #09090b;
    --bg-sidebar: #0f0f12;
    --bg-card: #131316;
    --bg-strip: #1c1c21;
    --border: #27272a;
    --text-main: #fafafa;
    --text-muted: #a1a1aa;
    --accent: #ef4444;
    --t1: #ef4444; --t2: #f97316; --t3: #eab308; --t4: #22c55e; --t5: #3b82f6;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background-color: var(--bg-app); color: var(--text-main); font-family: 'Inter', sans-serif; display: flex; height: 100vh; overflow: hidden; }

  /* --- SIDEBAR --- */
  .sidebar { width: 260px; background: var(--bg-sidebar); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 24px; }
  .brand { display: flex; align-items: center; gap: 12px; font-weight: 800; font-size: 20px; margin-bottom: 40px; }
  .brand img { width: 30px; height: 30px; }

  .nav-menu { flex-grow: 1; }
  .nav-item { 
    display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: 10px; 
    color: var(--text-muted); cursor: pointer; font-weight: 600; transition: 0.2s; margin-bottom: 4px;
  }
  .nav-item:hover, .nav-item.active { background: var(--bg-card); color: #fff; }
  .nav-item svg { width: 20px; height: 20px; }

  .discord-link {
    background: #5865F2; color: white; display: flex; align-items: center; justify-content: center; gap: 8px;
    padding: 12px; border-radius: 10px; text-decoration: none; font-weight: 700; transition: 0.2s;
  }
  .discord-link:hover { opacity: 0.9; transform: translateY(-2px); }

  /* --- MAIN CONTENT --- */
  .main-wrapper { flex-grow: 1; display: flex; flex-direction: column; height: 100vh; overflow-y: auto; }
  .top-bar { padding: 20px 40px; display: flex; justify-content: flex-end; position: sticky; top: 0; background: rgba(9,9,11,0.8); backdrop-filter: blur(10px); z-index: 10; }
  .search-wrapper { position: relative; width: 320px; }
  .search-input { 
    width: 100%; background: var(--bg-card); border: 1px solid var(--border); padding: 12px 16px 12px 40px; 
    border-radius: 12px; color: #fff; font-size: 14px; outline: none; transition: 0.2s;
  }
  .search-input:focus { border-color: var(--text-muted); box-shadow: 0 0 0 2px rgba(255,255,255,0.05); }
  .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-muted); }

  .view-container { padding: 0 40px 40px 40px; max-width: 1400px; margin: 0 auto; width: 100%; }

  /* --- GRID & LISTS --- */
  .tier-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 16px; }
  .tier-col { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; overflow: hidden; height: fit-content; }
  .col-header { padding: 14px; text-align: center; font-weight: 800; font-size: 14px; text-transform: uppercase; letter-spacing: 0.5px; }
  .player-list { padding: 10px; display: flex; flex-direction: column; gap: 8px; }

  .player-strip {
    display: flex; align-items: center; gap: 12px; padding: 10px; border-radius: 10px;
    background: var(--bg-strip); cursor: pointer; transition: 0.2s; border: 1px solid transparent;
  }
  .player-strip:hover { transform: translateY(-2px); border-color: var(--border); background: #27272a; }

  .p-avatar { width: 34px; height: 34px; border-radius: 8px; background: #000; }
  .p-name { font-weight: 600; font-size: 14px; flex-grow: 1; }
  .p-pts { font-size: 11px; font-weight: 800; color: var(--text-muted); opacity: 0.8; }

  /* --- EMPTY STATE --- */
  .not-found { text-align: center; padding: 80px 20px; }
  .not-found-icon { font-size: 48px; margin-bottom: 16px; display: block; }
  .not-found-text { color: var(--text-muted); font-size: 18px; font-weight: 500; }

  /* --- MODAL --- */
  .modal-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(12px);
    z-index: 100; display: none; align-items: center; justify-content: center; opacity: 0; transition: 0.3s;
  }
  .modal-overlay.open { display: flex; opacity: 1; }
  .modal-card { width: 400px; background: #18181b; border: 1px solid var(--border); border-radius: 32px; padding: 40px; text-align: center; position: relative; }
  .modal-bust { width: 140px; height: 140px; margin-bottom: 20px; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5)); }
  .close-btn { position: absolute; top: 20px; right: 20px; background: none; border: none; color: #fff; cursor: pointer; font-size: 20px; }

  /* --- OVERALL LEADERBOARD --- */
  .leaderboard { max-width: 900px; margin: 0 auto; display: flex; flex-direction: column; gap: 10px; }
  .rank-item {
    display: flex; align-items: center; gap: 20px; padding: 16px 24px;
    background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px;
  }
  .rank-pos { font-size: 24px; font-weight: 900; width: 40px; color: var(--accent); }
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

  <aside class="sidebar">
    <div class="brand">
      <img src="https://mctiers.com/tier_icons/nethop.svg">
      <span>NetheritePot</span>
    </div>

    <div class="nav-menu">
      <div class="nav-item active" id="btn-overall" onclick="switchView('overall')">
        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/></svg>
        Overall
      </div>
      <div class="nav-item" id="btn-nethpot" onclick="switchView('nethpot')">
        <svg fill="currentColor" viewBox="0 0 24 24"><path d="M4 15h16v-2H4v2zm0 4h16v-2H4v2zm0-8h16V9H4v2zm0-6v2h16V5H4z"/></svg>
        NethPot Grid
      </div>
    </div>

    <a href="https://discord.gg/accNzNbEu4" target="_blank" class="discord-link">
      <svg width="20" height="20" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03zM8.02 15.33c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.086 2.157 2.419c0 1.334-.947 2.419-2.157 2.419zm7.975 0c-1.183 0-2.157-1.085-2.157-2.419c0-1.333.955-2.419 2.157-2.419c1.21 0 2.176 1.086 2.157 2.419c0 1.334-.946 2.419-2.157 2.419z"/></svg>
      Discord
    </a>
  </aside>

  <main class="main-wrapper">
    <div class="top-bar">
      <div class="search-wrapper">
        <svg class="search-icon" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
        <input type="text" id="search" class="search-input" placeholder="Search for players..." onkeyup="renderViews()">
      </div>
    </div>

    <div class="view-container">
      <div id="view-overall" class="leaderboard"></div>
      <div id="view-nethpot" class="tier-grid" style="display:none"></div>
    </div>
  </main>

  <div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
    <div class="modal-card">
      <button class="close-btn" onclick="closeModal(null, true)">‚úï</button>
      <img id="m-bust" class="modal-bust" src="">
      <h2 id="m-name" style="font-size: 32px; font-weight: 800; margin-bottom: 8px;"></h2>
      <div id="m-tier-pill" style="display:inline-block; padding: 6px 12px; border-radius: 8px; font-weight: 800; font-size: 14px; margin-bottom: 24px;"></div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
        <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 16px; border: 1px solid var(--border);">
          <span style="font-size: 10px; color: var(--text-muted); font-weight: 700; display: block; margin-bottom: 4px;">POINTS</span>
          <span id="m-pts" style="font-size: 20px; font-weight: 800;"></span>
        </div>
        <div style="background: rgba(255,255,255,0.03); padding: 15px; border-radius: 16px; border: 1px solid var(--border);">
          <span style="font-size: 10px; color: var(--text-muted); font-weight: 700; display: block; margin-bottom: 4px;">REGION</span>
          <span id="m-region" style="font-size: 20px; font-weight: 800;"></span>
        </div>
      </div>
    </div>
  </div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB3FWTZ587KxVbe1POuw-2Rk5FSrcpZ_QU",
  authDomain: "tierlist-3305a.firebaseapp.com",
  databaseURL: "https://tierlist-3305a-default-rtdb.firebaseio.com",
  projectId: "tierlist-3305a",
  storageBucket: "tierlist-3305a.firebasestorage.app",
  appId: "1:410709885310:web:ceab1ca94e0f45513f332f"
};

const POINT_MAP = {
  "HT1": 60, "LT1": 45, "HT2": 30, "LT2": 20, "HT3": 10, "LT3": 6, "HT4": 4, "LT4": 3, "HT5": 2, "LT5": 1
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let players = [];
let currentTab = 'overall';

db.ref("players").on("value", snap => {
  const val = snap.val();
  players = val ? (Array.isArray(val) ? val : Object.values(val)) : [];
  renderViews();
});

function switchView(view) {
  currentTab = view;
  document.getElementById('view-overall').style.display = view === 'overall' ? 'flex' : 'none';
  document.getElementById('view-nethpot').style.display = view === 'nethpot' ? 'grid' : 'none';
  document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
  document.getElementById('btn-' + view).classList.add('active');
  renderViews();
}

function parse(p) {
  const rawTier = (p.tier || "LT5").toUpperCase();
  const cleanTier = rawTier.startsWith('R') ? rawTier.substring(1) : rawTier;
  return { 
    ...p, 
    points: POINT_MAP[cleanTier] || 0, 
    isRetired: rawTier.startsWith('R'), 
    displayTier: rawTier,
    colNum: cleanTier.match(/\d+/) ? cleanTier.match(/\d+/)[0] : "5"
  };
}

function renderViews() {
  const query = document.getElementById("search").value.toLowerCase();
  const parsed = players.map(parse).filter(p => p.name.toLowerCase().includes(query));
  
  const overallDiv = document.getElementById("view-overall");
  const gridDiv = document.getElementById("view-nethpot");

  if (parsed.length === 0) {
    const emptyHTML = `<div class="not-found"><span class="not-found-icon">üîç</span><p class="not-found-text">No players found matching "${query}"</p></div>`;
    overallDiv.innerHTML = emptyHTML;
    gridDiv.innerHTML = emptyHTML;
    gridDiv.style.display = 'block'; // Ensure it shows for grid too
    return;
  } else {
      gridDiv.style.display = currentTab === 'nethpot' ? 'grid' : 'none';
  }

  // --- OVERALL ---
  overallDiv.innerHTML = `<h2 style="margin-bottom:30px; font-size: 28px; font-weight: 800;">Global Leaderboard</h2>`;
  [...parsed].sort((a,b) => b.points - a.points).slice(0, 50).forEach((p, i) => {
    const div = document.createElement("div");
    div.className = "rank-item";
    div.innerHTML = `<div class="rank-pos">#${i+1}</div><img class="p-avatar" src="https://mc-heads.net/avatar/${p.name}/64"><div class="p-name">${p.name}</div><div class="p-pts">${p.points} PTS</div>`;
    div.onclick = () => openModal(p);
    overallDiv.appendChild(div);
  });

  // --- NETHOP GRID ---
  gridDiv.innerHTML = "";
  ["1", "2", "3", "4", "5"].forEach(num => {
    const col = document.createElement("div");
    col.className = "tier-col";
    col.innerHTML = `<div class="col-header" style="background:var(--t${num})">Tier ${num}</div>`;
    const list = document.createElement("div");
    list.className = "player-list";
    
    parsed.filter(p => !p.isRetired && p.colNum === num)
      .sort((a,b) => b.points - a.points)
      .forEach(p => {
        const item = document.createElement("div");
        item.className = "player-strip";
        item.innerHTML = `<img class="p-avatar" src="https://mc-heads.net/avatar/${p.name}/64"><div class="p-name">${p.name}</div><div class="p-pts">${p.points}</div>`;
        item.onclick = () => openModal(p);
        list.appendChild(item);
      });
    col.appendChild(list);
    gridDiv.appendChild(col);
  });
}

function openModal(p) {
  document.getElementById("m-name").innerText = p.name;
  document.getElementById("m-pts").innerText = p.points;
  document.getElementById("m-region").innerText = p.region || 'NA';
  const pill = document.getElementById("m-tier-pill");
  pill.innerText = p.displayTier;
  pill.style.background = `var(--t${p.colNum})`;
  document.getElementById("m-bust").src = `https://render.crafty.gg/3d/bust/${p.name}`;
  document.getElementById("modal-overlay").classList.add("open");
}

function closeModal(e, force) { if(force || (e && e.target.id === 'modal-overlay')) document.getElementById("modal-overlay").classList.remove("open"); }
</script>
</body>
</html>
