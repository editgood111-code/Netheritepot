<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NetheritePot | Rankings</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-app: #09090b; --bg-card: #131316; --bg-strip: #1c1c21;
    --border: #27272a; --text-main: #fafafa; --text-muted: #a1a1aa; --accent: #ef4444;
    --t1: #ef4444; --t2: #f97316; --t3: #eab308; --t4: #22c55e; --t5: #3b82f6;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background-color: var(--bg-app); color: var(--text-main); font-family: 'Inter', sans-serif; }
  
  /* Top Navbar with Navigation on Right */
  .navbar {
    height: 70px; background: var(--bg-card); border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 40px; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px);
  }
  .nav-brand { font-weight: 900; font-size: 22px; display: flex; align-items: center; gap: 10px; }
  .nav-right-group { display: flex; align-items: center; gap: 15px; }
  .nav-links { display: flex; gap: 5px; }
  .nav-item { 
    padding: 10px 18px; border-radius: 10px; color: var(--text-muted); 
    cursor: pointer; font-weight: 600; font-size: 14px; transition: 0.2s; 
  }
  .nav-item:hover { color: #fff; background: rgba(255,255,255,0.05); }
  .nav-item.active { background: rgba(255,255,255,0.08); color: #fff; border: 1px solid var(--border); }
  
  .discord-btn {
    background: #5865F2; color: white; display: flex; align-items: center; gap: 8px;
    padding: 10px 16px; border-radius: 10px; text-decoration: none; font-weight: 700; font-size: 13px;
    transition: 0.2s;
  }
  .discord-btn:hover { opacity: 0.9; transform: translateY(-1px); }

  .container { max-width: 1200px; margin: 30px auto; padding: 0 20px; }
  
  /* Search Bar Area */
  .search-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
  .view-label { font-size: 24px; font-weight: 800; }
  .search-input { width: 300px; background: var(--bg-card); border: 1px solid var(--border); padding: 12px 18px; border-radius: 12px; color: #fff; outline: none; transition: 0.2s; }
  .search-input:focus { border-color: var(--accent); }

  /* Overall Rank Items */
  .rank-item { 
    display: flex; align-items: center; gap: 20px; padding: 18px 24px; 
    background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; 
    margin-bottom: 12px; transition: 0.2s; cursor: pointer; 
  }
  .rank-item:hover { transform: translateY(-2px); border-color: #3f3f46; background: #1a1a1e; }
  .rank-pos { font-size: 26px; font-weight: 900; width: 50px; text-align: center; color: var(--text-muted); }
  
  .p-title { font-size: 11px; font-weight: 800; text-transform: uppercase; margin-top: 4px; display: flex; align-items: center; gap: 5px; }
  .title-1 { color: #facc15; } .title-2 { color: #f87171; } .title-3 { color: #60a5fa; } .title-4 { color: #a1a1aa; }

  /* NethPot Grid */
  .tier-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(210px, 1fr)); gap: 18px; }
  .tier-col { background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; overflow: hidden; height: fit-content; padding-bottom: 10px; }
  .col-header { padding: 14px; text-align: center; font-weight: 900; font-size: 12px; text-transform: uppercase; }
  .player-strip { display: flex; align-items: center; gap: 10px; padding: 10px; margin: 6px 10px; background: var(--bg-strip); border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; transition: 0.2s; }
  .player-strip:hover { background: #27272a; }

  /* Classic Player Modal */
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(12px); z-index: 200; display: none; align-items: center; justify-content: center; opacity: 0; transition: 0.3s; }
  .modal-overlay.open { display: flex; opacity: 1; }
  .modal-card { width: 420px; background: #18181b; border: 1px solid var(--border); border-radius: 35px; padding: 45px; text-align: center; position: relative; }
  .modal-bust { width: 150px; margin-bottom: 15px; filter: drop-shadow(0 15px 30px rgba(0,0,0,0.6)); }
  .modal-tier-badge { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; border-radius: 12px; font-weight: 900; font-size: 14px; margin-bottom: 25px; }
  .modal-stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
  .m-stat-box { background: rgba(255,255,255,0.03); border: 1px solid var(--border); padding: 18px; border-radius: 20px; }
  .m-stat-label { font-size: 10px; color: var(--text-muted); font-weight: 800; text-transform: uppercase; display: block; margin-bottom: 6px; }
  .m-stat-val { font-size: 20px; font-weight: 900; }
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

  <nav class="navbar">
    <div class="nav-brand">
      <img src="https://mctiers.com/tier_icons/nethop.svg" width="30"> NETHERITEPOT
    </div>
    <div class="nav-right-group">
      <div class="nav-links">
        <div class="nav-item active" id="btn-overall" onclick="switchView('overall')">Top 10</div>
        <div class="nav-item" id="btn-nethpot" onclick="switchView('nethpot')">NethPot</div>
      </div>
      <a href="https://discord.gg/accNzNbEu4" target="_blank" class="discord-btn">
        <svg width="18" height="18" fill="currentColor" viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0a12.64 12.64 0 0 0-.617-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.09 14.09 0 0 0 1.226-1.994a.076.076 0 0 0-.041-.106a13.107 13.107 0 0 1-1.872-.892a.077.077 0 0 1-.008-.128a10.2 10.2 0 0 0 .372-.292a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127a12.299 12.299 0 0 1-1.873.892a.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028a19.839 19.839 0 0 0 6.002-3.03a.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
        Discord
      </a>
    </div>
  </nav>

  <div class="container">
    <div class="search-row">
      <h2 id="view-title" class="view-label">Top 10</h2>
      <input type="text" id="search" class="search-input" placeholder="Search for a player..." onkeyup="renderViews()">
    </div>

    <div id="view-overall"></div>
    <div id="view-nethpot" style="display:none" class="tier-grid"></div>
  </div>

  <div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
    <div class="modal-card">
      <img id="m-bust" class="modal-bust" src="">
      <h2 id="m-name" style="font-size: 34px; font-weight: 800;"></h2>
      <div id="m-tier-pill" class="modal-tier-badge"></div>
      
      <div class="modal-stats-grid">
        <div class="m-stat-box">
          <span class="m-stat-label">Total Points</span>
          <span id="m-pts" class="m-stat-val"></span>
        </div>
        <div class="m-stat-box">
          <span class="m-stat-label">Region</span>
          <span id="m-region" class="m-stat-val"></span>
        </div>
      </div>
    </div>
  </div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB3FWTZ587KxVbe1POuw-2Rk5FSrcpZ_QU",
  databaseURL: "https://tierlist-3305a-default-rtdb.firebaseio.com",
  projectId: "tierlist-3305a",
  appId: "1:410709885310:web:ceab1ca94e0f45513f332f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let players = [];
let activeTab = 'overall';

const POINT_MAP = { "HT1": 60, "LT1": 45, "HT2": 30, "LT2": 20, "HT3": 10, "LT3": 6, "HT4": 4, "LT4": 3, "HT5": 2, "LT5": 1 };

db.ref("players").on("value", snap => {
  const data = snap.val();
  players = data ? (Array.isArray(data) ? data : Object.values(data)) : [];
  renderViews();
});

function switchView(tab) {
  activeTab = tab;
  document.getElementById('view-overall').style.display = tab === 'overall' ? 'block' : 'none';
  document.getElementById('view-nethpot').style.display = tab === 'nethpot' ? 'grid' : 'none';
  document.getElementById('view-title').innerText = tab === 'overall' ? 'Top 10' : 'NethPot Grid';
  document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
  document.getElementById('btn-' + tab).classList.add('active');
  renderViews();
}

function getTitleHtml(rank) {
  if (rank === 1) return `<span class="p-title title-1">üèÜ Combat Grandmaster</span>`;
  if (rank <= 3) return `<span class="p-title title-2">‚öîÔ∏è Combat Master</span>`;
  if (rank <= 7) return `<span class="p-title title-3">üî• Combat Ace</span>`;
  if (rank <= 10) return `<span class="p-title title-4">üéñÔ∏è Combat Specialist</span>`;
  return "";
}

function renderViews() {
  const query = document.getElementById("search").value.toLowerCase();
  
  // Robust matching logic
  const allProcessed = players.map(p => {
    let rawTier = (p.tier || "LT5").toUpperCase();
    let cleanTier = rawTier.replace('R', '').replace(/[^H|L|T|1-5]/g, ""); 
    return { ...p, pts: POINT_MAP[cleanTier] || 0, col: cleanTier.match(/\d/)?.[0] || "5", displayTier: rawTier, cleanTier: cleanTier };
  }).filter(p => p.name && p.name.toLowerCase().includes(query));

  const overall = document.getElementById("view-overall");
  const grid = document.getElementById("view-nethpot");

  // Top 10 View
  overall.innerHTML = "";
  const leaderboard = [...allProcessed].sort((a,b) => b.pts - a.pts).slice(0, 10);
  
  if (leaderboard.length === 0) {
    overall.innerHTML = `<div style="text-align:center; padding:100px; opacity:0.4;">No players found matching "${query}"</div>`;
  } else {
    leaderboard.forEach((p, i) => {
      overall.innerHTML += `
        <div class="rank-item" onclick="openModal('${p.name}', '${p.displayTier}', ${p.pts}, '${p.region}')">
          <div class="rank-pos">#${i+1}</div>
          <img src="https://mc-heads.net/avatar/${p.name}/44" style="border-radius:10px;">
          <div style="flex-grow:1">
            <span style="font-weight: 800; font-size: 18px;">${p.name}</span>
            ${getTitleHtml(i+1)}
          </div>
          <div style="text-align:right">
            <span style="display:block; font-size: 20px; font-weight: 900;">${p.pts}</span>
            <span style="font-size: 9px; font-weight: 800; color: var(--text-muted);">POINTS</span>
          </div>
        </div>`;
    });
  }

  // NethPot Grid View - Sorted by Points (Ensures HT before LT)
  grid.innerHTML = "";
  ["1", "2", "3", "4", "5"].forEach(num => {
    let colHtml = `<div class="tier-col"><div class="col-header" style="background:var(--t${num})">Tier ${num}</div>`;
    allProcessed
      .filter(p => p.col === num)
      .sort((a, b) => b.pts - a.pts) // Sorts HT (higher pts) before LT (lower pts)
      .forEach(p => {
        colHtml += `<div class="player-strip" onclick="openModal('${p.name}', '${p.displayTier}', ${p.pts}, '${p.region}')"><img src="https://mc-heads.net/avatar/${p.name}/22" style="border-radius:4px;"> ${p.name}</div>`;
      });
    grid.innerHTML += colHtml + '</div>';
  });
}

function openModal(name, tier, pts, region) {
  document.getElementById("m-name").innerText = name;
  document.getElementById("m-pts").innerText = pts;
  document.getElementById("m-region").innerText = region || "NA";
  
  const pill = document.getElementById("m-tier-pill");
  pill.innerText = ` ${tier}`;
  const tierNum = tier.replace('R', '').match(/\d/)?.[0] || "5";
  pill.style.background = `var(--t${tierNum})`;
  pill.style.color = "#fff";

  document.getElementById("m-bust").src = `https://render.crafty.gg/3d/bust/${name}`;
  document.getElementById("modal-overlay").classList.add("open");
}

function closeModal(e) { if(e.target.id === 'modal-overlay') document.getElementById("modal-overlay").classList.remove("open"); }
</script>
</body>
</html>
