<!DOCTYPE html>
<html lang="en" class="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NetheritePot | Professional Rankings</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg-app: #09090b; --bg-card: #131316; --bg-strip: #1c1c21;
    --border: #27272a; --text-main: #fafafa; --text-muted: #a1a1aa; --accent: #ef4444;
    --t1: #ef4444; --t2: #f97316; --t3: #eab308; --t4: #22c55e; --t5: #3b82f6;
  }
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body { background-color: var(--bg-app); color: var(--text-main); font-family: 'Inter', sans-serif; }
  
  /* Top Navigation */
  .navbar {
    height: 70px; background: var(--bg-card); border-bottom: 1px solid var(--border);
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 40px; position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px);
  }
  .nav-links { display: flex; gap: 8px; }
  .nav-item { 
    padding: 10px 18px; border-radius: 10px; color: var(--text-muted); 
    cursor: pointer; font-weight: 600; font-size: 14px; transition: 0.2s; 
  }
  .nav-item.active { background: var(--accent); color: #fff; }

  .container { max-width: 1100px; margin: 30px auto; padding: 0 20px; }
  
  /* Search */
  .search-row { display: flex; justify-content: flex-end; margin-bottom: 25px; }
  .search-input { 
    width: 280px; background: var(--bg-card); border: 1px solid var(--border); 
    padding: 12px 18px; border-radius: 12px; color: #fff; outline: none; 
  }

  /* Ranking Cards */
  .rank-item { 
    display: flex; align-items: center; gap: 20px; padding: 18px 24px; 
    background: var(--bg-card); border: 1px solid var(--border); border-radius: 18px; 
    margin-bottom: 10px; transition: 0.2s; cursor: pointer; 
  }
  .rank-item:hover { border-color: #3f3f46; background: #1a1a1e; }
  .rank-pos { font-size: 24px; font-weight: 900; width: 50px; color: var(--text-muted); }
  
  /* Titles */
  .p-title { font-size: 11px; font-weight: 800; text-transform: uppercase; margin-top: 4px; display: flex; align-items: center; gap: 5px; }
  .title-1 { color: #facc15; } .title-2 { color: #f87171; } .title-3 { color: #60a5fa; } .title-4 { color: #a1a1aa; }

  /* Grid View */
  .tier-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; }
  .tier-col { background: var(--bg-card); border: 1px solid var(--border); border-radius: 20px; overflow: hidden; }
  .col-header { padding: 12px; text-align: center; font-weight: 900; font-size: 11px; text-transform: uppercase; }
  .player-strip { display: flex; align-items: center; gap: 10px; padding: 10px; margin: 5px 10px; background: var(--bg-strip); border-radius: 10px; font-size: 14px; font-weight: 600; cursor: pointer; }

  /* Modal */
  .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); backdrop-filter: blur(8px); z-index: 200; display: none; align-items: center; justify-content: center; }
  .modal-overlay.open { display: flex; }
  .modal-card { width: 360px; background: #18181b; border: 1px solid var(--border); border-radius: 30px; padding: 35px; text-align: center; }
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>

  <nav class="navbar">
    <div style="font-weight: 900; font-size: 20px;">NETHERITE<span style="color:var(--accent)">POT</span></div>
    <div class="nav-links">
      <div class="nav-item active" id="btn-overall" onclick="switchView('overall')">Rankings</div>
      <div class="nav-item" id="btn-nethpot" onclick="switchView('nethpot')">Tier List</div>
    </div>
  </nav>

  <div class="container">
    <div class="search-row">
      <input type="text" id="search" class="search-input" placeholder="Search IGN..." onkeyup="renderViews()">
    </div>

    <div id="view-overall"></div>
    <div id="view-nethpot" style="display:none" class="tier-grid"></div>
  </div>

  <div class="modal-overlay" id="modal-overlay" onclick="closeModal(event)">
    <div class="modal-card">
      <img id="m-bust" style="width:110px; margin-bottom:15px;">
      <h2 id="m-name" style="font-size: 26px; font-weight: 800;"></h2>
      <p id="m-tier" style="font-weight: 700; color: var(--accent); margin-bottom: 15px;"></p>
      <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 15px;">
        <span style="font-size: 10px; color: var(--text-muted); font-weight: 800;">TOTAL SCORE</span>
        <div id="m-pts" style="font-size: 20px; font-weight: 900;"></div>
      </div>
    </div>
  </div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyB3FWTZ587KxVbe1POuw-2Rk5FSrcpZ_QU",
  databaseURL: "https://tierlist-3305a-default-rtdb.firebaseio.com",
  projectId: "tierlist-3305a",
  appId: "1:410709885310:web:ceab1ca94e0f45513f332f"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
let players = [];

const POINT_MAP = { "HT1": 60, "LT1": 45, "HT2": 30, "LT2": 20, "HT3": 10, "LT3": 6, "HT4": 4, "LT4": 3, "HT5": 2, "LT5": 1 };

db.ref("players").on("value", snap => {
  const data = snap.val();
  // Ensure we capture all player objects regardless of structure
  players = data ? Object.values(data) : [];
  renderViews();
});

function switchView(v) {
  document.getElementById('view-overall').style.display = v === 'overall' ? 'block' : 'none';
  document.getElementById('view-nethpot').style.display = v === 'nethpot' ? 'grid' : 'none';
  document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
  document.getElementById('btn-' + v).classList.add('active');
  renderViews();
}

function getTitleHtml(rank) {
  if (rank === 1) return `<span class="p-title title-1">üèÜ Combat Grandmaster</span>`;
  if (rank <= 3) return `<span class="p-title title-2">‚öîÔ∏è Combat Master</span>`;
  if (rank <= 7) return `<span class="p-title title-3">üî• Combat Ace</span>`;
  if (rank <= 10) return `<span class="p-title title-4">üéñÔ∏è Combat Specialist</span>`;
  return "";
}

function renderViews() {
  const query = document.getElementById("search").value.toLowerCase();
  
  // Robust data processing
  const processed = players.map(p => {
    // Handle potential missing tier or case-sensitivity
    let rawTier = (p.tier || "LT5").toUpperCase();
    // Clean up 'R' prefix or other artifacts
    let cleanTier = rawTier.replace(/[^H|L|T|1-5]/g, ""); 
    return { 
      ...p, 
      pts: POINT_MAP[cleanTier] || 0, 
      col: cleanTier.match(/\d/)?.[0] || "5", 
      displayTier: rawTier 
    };
  }).filter(p => p.name && p.name.toLowerCase().includes(query));

  const overall = document.getElementById("view-overall");
  const grid = document.getElementById("view-nethpot");

  // Leaderboard
  overall.innerHTML = processed.length ? "" : `<div style="text-align:center; padding:50px; opacity:0.5;">No players found.</div>`;
  processed.sort((a,b) => b.pts - a.pts).forEach((p, i) => {
    overall.innerHTML += `
      <div class="rank-item" onclick="openModal('${p.name}', '${p.displayTier}', ${p.pts})">
        <div class="rank-pos">#${i+1}</div>
        <img src="https://mc-heads.net/avatar/${p.name}/44" style="border-radius:8px;">
        <div style="flex-grow:1">
          <span style="font-weight: 800; font-size: 17px;">${p.name}</span>
          ${getTitleHtml(i+1)}
        </div>
        <div style="text-align:right">
          <span style="display:block; font-size: 18px; font-weight: 900;">${p.pts}</span>
          <span style="font-size: 9px; font-weight: 800; color: var(--text-muted);">POINTS</span>
        </div>
      </div>`;
  });

  // Grid
  grid.innerHTML = "";
  ["1", "2", "3", "4", "5"].forEach(num => {
    let colHtml = `<div class="tier-col"><div class="col-header" style="background:var(--t${num})">Tier ${num}</div>`;
    processed.filter(p => p.col === num).forEach(p => {
      colHtml += `<div class="player-strip" onclick="openModal('${p.name}', '${p.displayTier}', ${p.pts})"><img src="https://mc-heads.net/avatar/${p.name}/22" style="border-radius:4px;"> ${p.name}</div>`;
    });
    grid.innerHTML += colHtml + '</div>';
  });
}

function openModal(name, tier, pts) {
  document.getElementById("m-name").innerText = name;
  document.getElementById("m-tier").innerText = tier;
  document.getElementById("m-pts").innerText = pts;
  document.getElementById("m-bust").src = `https://render.crafty.gg/3d/bust/${name}`;
  document.getElementById("modal-overlay").classList.add("open");
}

function closeModal(e) { if(e.target.id === 'modal-overlay') document.getElementById("modal-overlay").classList.remove("open"); }
</script>
</body>
</html>
