<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Netheritepot Tierlist</title>
<style>
  :root{
    --bg:#0d1117; --card:#161b22; --muted:#9aa; --accent:#238636; --accent-hover:#2ea043;
    --col-as:#6f9bff; --col-eu:#8a2be2; --col-na:#ffb86b; --col-me:#f66; --col-au:#2eea9e;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:Arial,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;color:#c9d1d9;
       background:var(--bg);padding:20px;text-align:center;}
  h1{color:#ffcc00;margin:0 0 14px 0;font-size:20px}

  /* Search */
  .search-wrap{display:flex;justify-content:center;gap:8px;margin-bottom:12px;align-items:center}
  .search-wrap input{
    width:260px;padding:8px 10px;border-radius:6px;background:var(--card);border:1px solid #30363d;color:#c9d1d9;
    outline:none;font-size:14px;
  }
  .search-wrap button{
    padding:8px 12px;border-radius:6px;border:none;background:var(--accent);color:#fff;cursor:pointer;font-weight:700;
  }
  .search-wrap button:hover{background:var(--accent-hover)}

  /* Search mini-card */
  #search-result{display:flex;justify-content:center;gap:10px;flex-wrap:wrap;margin-bottom:12px}
  .mini-card{background:var(--card);border:1px solid #30363d;border-radius:10px;padding:12px;width:260px;display:flex;flex-direction:column;align-items:center;gap:8px}
  .mini-card img.skin{width:68px;height:68px;border-radius:8px;border:2px solid #fff;object-fit:cover}
  .mini-card .region{color:var(--muted);font-size:13px}
  .mini-card .name{font-weight:700;font-size:16px}
  .mini-card .alias-note{font-size:12px;color:#ffd;margin-top:4px}
  .mini-card .namemc{color:#6f9bff;text-decoration:none;font-size:13px}
  .mini-card .tier-box{display:flex;align-items:center;gap:8px;background:#212526;padding:8px 12px;border-radius:8px;font-weight:700}
  .mini-card .tier-box img{width:24px;height:24px}

  /* Leaderboard container */
  .leaderboard{display:flex;justify-content:space-between;max-width:1200px;margin:0 auto;gap:10px;overflow-x:auto;padding-bottom:18px}
  .tier-column{flex:1;min-width:180px}
  .tier-column h2{font-size:15px;color:#58a6ff;border-bottom:1px solid #30363d;padding-bottom:6px;margin:0 0 8px;text-align:center}

  /* rows area */
  .rows{display:flex;flex-direction:column;gap:6px;padding:0 6px}

  /* compact player row */
  .player-row{
    height:38px; /* fixed small row height */
    display:flex;align-items:center;gap:8px;padding:4px 8px;border-radius:8px;position:relative;
    background:transparent; transition:transform .16s ease, box-shadow .16s ease;
    overflow:visible;
  }
  .player-row:hover{transform:translateX(8px);box-shadow:0 6px 20px rgba(0,0,0,0.6);z-index:50}

  .player-row .head{width:28px;height:28px;border-radius:6px;border:1px solid #fff;object-fit:cover}
  .player-row .player-name{font-weight:600;font-size:13px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100px}
  .player-row .left-border{position:absolute;left:0;top:0;bottom:0;width:4px;border-radius:8px}
  /* tooltip shown to the right of row on hover, positioned per-row to avoid overlap */
  .player-row .tooltip{
    position:absolute; left:calc(100% + 10px); top:50%; transform:translateY(-50%);
    background:var(--accent); color:#fff; padding:6px 8px;border-radius:6px;font-size:13px;white-space:nowrap;
    opacity:0; pointer-events:none; transition:opacity .12s;
    z-index:999;
  }
  .player-row:hover .tooltip{opacity:1; pointer-events:auto}

  /* small controls */
  .controls{margin-top:10px;display:flex;justify-content:center;gap:10px}
  .controls button{padding:8px 12px;border-radius:6px;border:none;background:var(--accent);color:#fff;cursor:pointer}
  .controls button:hover{background:var(--accent-hover)}
  .small{font-size:12px;color:var(--muted);margin-top:8px}

  @media (max-width:900px){
    .leaderboard{flex-direction:column;align-items:flex-start}
    .tier-column{min-width:260px}
  }
</style>

<!-- Firebase SDK (unchanged) -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
  <h1>Netheritepot Tierlist</h1>

  <div class="search-wrap">
    <input id="search-input" placeholder="Search any player (ign)">
    <button onclick="searchPlayer()">Search</button>
  </div>

  <div id="search-result"></div>

  <div class="leaderboard" id="leaderboard-container"></div>

  <div class="controls">
    <button onclick="addPlayer()">Add / Update (admin)</button>
    <button onclick="removePlayer()">Remove (admin)</button>
  </div>
  <div class="small">Admin key required for add/remove. Premium players use live skin (mc-heads) automatically.</div>

<script>
/* ---------- CONFIG (do not change if unsure) ---------- */
const secretKey = "aceppp1122";
const firebaseConfig = {
  apiKey: "AIzaSyB3FWTZ587KxVbe1POuw-2Rk5FSrcpZ_QU",
  authDomain: "tierlist-3305a.firebaseapp.com",
  databaseURL: "https://tierlist-3305a-default-rtdb.firebaseio.com",
  projectId: "tierlist-3305a",
  storageBucket: "tierlist-3305a.firebasestorage.app",
  messagingSenderId: "410709885310",
  appId: "1:410709885310:web:ceab1ca94e0f45513f332f"
};
const regionList = ["AS","EU","ME","AU","NA"];
const categories = ["T1","T2","T3","T4","T5"];
const categoryMap = {
  "HT1":"T1","LT1":"T1","RHT1":"T1","RLT1":"T1",
  "HT2":"T2","LT2":"T2","RHT2":"T2","RLT2":"T2",
  "HT3":"T3","LT3":"T3","RHT3":"T3","RLT3":"T3",
  "HT4":"T4","LT4":"T4","HT5":"T5","LT5":"T5"
};
const tierOrder = ["HT","RHT","LT","RLT"];

/* ---------- Firebase init ---------- */
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const playersRef = db.ref("players");

/* players array structure:
 { name:"Swight", tier:"HT1", region:"EU", type:"premium"|"crack", skin:"url", aliases:[] }
*/
let players = [];

/* helper: skin url */
function getHeadURL(name, type="premium", size=32){
  if(!name) return `https://mc-heads.net/avatar/Steve/${size}`;
  return (type && type.toLowerCase()==="premium") ? `https://mc-heads.net/avatar/${encodeURIComponent(name)}/${size}` : `https://mc-heads.net/avatar/Steve/${size}`;
}

/* load from firebase; if empty create defaults */
playersRef.once("value", snapshot=>{
  const data = snapshot.val();
  if(Array.isArray(data) && data.length>0){
    players = data;
  } else if(data && typeof data === "object"){
    // convert object to array if needed
    try{ players = Array.isArray(data) ? data : Object.values(data); } catch(e){ players = []; }
  } else {
    players = [
      { name:"Swight", tier:"HT1", region:"EU", type:"premium", skin:getHeadURL("Swight","premium",32), aliases:[] },
      { name:"Marlowww", tier:"LT2", region:"NA", type:"premium", skin:getHeadURL("Marlowww","premium",32), aliases:[] },
      { name:"ItzRealMe", tier:"HT3", region:"AS", type:"premium", skin:getHeadURL("ItzRealMe","premium",32), aliases:[] }
    ];
    playersRef.set(players);
  }
  render();
});

/* save */
function savePlayers(){ playersRef.set(players); }

/* normalize */
function n(s){ return (s||"").toLowerCase().trim(); }

/* find by name or alias */
function findPlayerByNameOrAlias(q){
  const s = n(q);
  for(const p of players){
    if(n(p.name) === s) return { player:p, type:"name" };
    if(Array.isArray(p.aliases)){
      for(const a of p.aliases){
        if(n(a) === s) return { player:p, type:"alias", alias:a };
      }
    }
  }
  return null;
}

/* ---------- RENDER ---------- */
function render(){
  // update premium skins to current name
  players.forEach(p=>{
    if(p.type && p.type.toLowerCase()==="premium"){
      p.skin = getHeadURL(p.name,"premium",32);
    }
  });

  const container = document.getElementById("leaderboard-container");
  container.innerHTML = "";
  const cols = {};
  categories.forEach(cat=>{
    const col = document.createElement("div");
    col.className = "tier-column";
    const h2 = document.createElement("h2");
    h2.textContent = cat;
    col.appendChild(h2);
    const rows = document.createElement("div");
    rows.className = "rows";
    col.appendChild(rows);
    container.appendChild(col);
    cols[cat] = rows;
  });

  // group then sort per column (HT > RHT > LT > RLT), alphabetical after
  categories.forEach(cat=>{
    const catPlayers = players.filter(p => categoryMap[p.tier] === cat);
    catPlayers.sort((a,b)=>{
      const aPref = a.tier.replace(/[0-9]/g,"").slice(0,4);
      const bPref = b.tier.replace(/[0-9]/g,"").slice(0,4);
      const ai = tierOrder.indexOf(aPref);
      const bi = tierOrder.indexOf(bPref);
      if(ai !== bi) return ai - bi;
      return a.name.localeCompare(b.name, undefined, {sensitivity:"base"});
    });

    catPlayers.forEach(p=>{
      const row = document.createElement("div");
      row.className = "player-row";
      row.style.position = "relative";

      const left = document.createElement("div");
      left.className = "left-border";
      left.style.background = regionColor(p.region);
      left.style.left = "0"; left.style.top = "0"; left.style.bottom = "0"; left.style.width = "4px";
      left.style.position = "absolute"; left.style.borderRadius = "8px";

      const head = document.createElement("img");
      head.className = "head";
      head.src = p.skin || getHeadURL(p.name,p.type,32);
      head.alt = p.name;

      const nameSpan = document.createElement("div");
      nameSpan.className = "player-name";
      nameSpan.textContent = p.name;

      const tooltip = document.createElement("div");
      tooltip.className = "tooltip";
      tooltip.textContent = `${p.region} | ${p.tier}`;

      row.appendChild(left);
      row.appendChild(head);
      row.appendChild(nameSpan);
      row.appendChild(tooltip);

      // improve interaction: ensure row brings to front when hovered (so tooltip visible)
      row.addEventListener("mouseenter", ()=>{ row.style.zIndex = 60; });
      row.addEventListener("mouseleave", ()=>{ row.style.zIndex = ""; });

      cols[cat].appendChild(row);
    });
  });
}

/* region -> color */
function regionColor(r){
  if(!r) return "#888";
  switch((r||"").toUpperCase()){
    case "AS": return "var(--col-as)";
    case "EU": return "var(--col-eu)";
    case "NA": return "var(--col-na)";
    case "ME": return "var(--col-me)";
    case "AU": return "var(--col-au)";
    default: return "#999";
  }
}

/* ---------- Admin add/update ---------- */
async function addPlayer(){
  const key = prompt("Enter admin key:");
  if(key !== secretKey){ alert("Unauthorized"); return; }

  let inputName = prompt("Enter player IGN or alias to add/update (example: Swight):");
  if(!inputName) return;
  inputName = inputName.trim();

  const existing = findPlayerByNameOrAlias(inputName);
  if(existing){
    const p = existing.player;
    const newTier = prompt(`Player found (${p.name}). Enter tier to set:`, p.tier) || p.tier;
    const newRegion = prompt(`Region (AS, EU, ME, AU, NA):`, p.region) || p.region;
    const newType = prompt(`Account type (premium/crack):`, p.type || "premium") || p.type || "premium";
    if(confirm("Rename player? (OK = rename)")){
      const newName = prompt("Enter new current IGN (exact):", p.name);
      if(newName && newName.trim()){
        p.name = newName.trim();
        if(newType.toLowerCase()==="premium") p.skin = getHeadURL(p.name,"premium",32);
      }
    }
    p.tier = newTier;
    p.region = newRegion.toUpperCase();
    p.type = newType.toLowerCase();
    if(p.type === "premium") p.skin = getHeadURL(p.name,"premium",32);
    else p.skin = getHeadURL("Steve","crack",32);
    savePlayers(); render(); alert("Player updated.");
    return;
  }

  // not existing -> check Mojang
  let isCurrent = null;
  try{
    const res = await fetch(`https://api.mojang.com/users/profiles/minecraft/${encodeURIComponent(inputName)}`);
    isCurrent = (res.status === 200);
  }catch(e){
    console.warn("Mojang lookup failed", e);
    isCurrent = null;
  }

  if(isCurrent === false){
    const choice = prompt(`"${inputName}" is not a current Minecraft IGN. Choose:
1 = Add as alias to existing player
2 = Provide current IGN now (add current and store ${inputName} as alias)
3 = Add as-is (store this as current)
Enter 1,2 or 3:`);
    if(choice === "1"){
      const target = prompt("Enter CURRENT IGN to attach alias to:");
      if(!target){ alert("Cancelled."); return; }
      const foundTarget = findPlayerByNameOrAlias(target);
      if(!foundTarget){ alert("Target not found. Add the current IGN first."); return; }
      const p = foundTarget.player;
      p.aliases = p.aliases || [];
      if(!p.aliases.map(a=>n(a)).includes(n(inputName))) p.aliases.push(inputName);
      savePlayers(); render(); alert("Alias added."); return;
    } else if(choice === "2"){
      const current = prompt("Enter the CURRENT IGN now:");
      if(!current){ alert("Cancelled."); return; }
      const tier = prompt("Tier (HT1.. / RHT..):","HT1") || "HT1";
      const region = prompt("Region (AS, EU, ME, AU, NA):","NA").toUpperCase();
      const type = prompt("Account type (premium/crack):","premium").toLowerCase();
      const newPlayer = { name: current.trim(), aliases:[inputName], tier, region, type, skin:type==="premium"?getHeadURL(current.trim(),"premium",32):getHeadURL("Steve","crack",32) };
      players.push(newPlayer); savePlayers(); render(); alert("Added with alias."); return;
    } else if(choice === "3"){
      const tier = prompt("Tier (HT1.. / RHT..):","HT1") || "HT1";
      const region = prompt("Region (AS, EU, ME, AU, NA):","NA").toUpperCase();
      const type = prompt("Account type (premium/crack):","crack").toLowerCase();
      const newPlayer = { name: inputName, aliases:[], tier, region, type, skin:type==="premium"?getHeadURL(inputName,"premium",32):getHeadURL("Steve","crack",32) };
      players.push(newPlayer); savePlayers(); render(); alert("Added (as-is)."); return;
    } else { alert("Cancelled."); return; }
  } else {
    // is current or unknown
    const tier = prompt("Tier (HT1.. / RHT..):","HT1") || "HT1";
    const region = prompt("Region (AS, EU, ME, AU, NA):","NA").toUpperCase();
    const type = prompt("Account type (premium/crack):","premium").toLowerCase();
    const newPlayer = { name: inputName, aliases:[], tier, region, type, skin:type==="premium"?getHeadURL(inputName,"premium",32):getHeadURL("Steve","crack",32) };
    players.push(newPlayer); savePlayers(); render(); alert("Added."); return;
  }
}

/* ---------- Remove ---------- */
function removePlayer(){
  const key = prompt("Enter admin key:");
  if(key !== secretKey){ alert("Unauthorized"); return; }
  const name = prompt("Enter exact IGN to remove (or alias):");
  if(!name) return;
  const before = players.length;
  players = players.filter(p => n(p.name) !== n(name) && !(Array.isArray(p.aliases) && p.aliases.map(a=>n(a)).includes(n(name))));
  if(players.length === before){ alert("Player not found."); return; }
  savePlayers(); render(); alert("Removed (if existed).");
}

/* ---------- Search ---------- */
async function searchPlayer(){
  const q = (document.getElementById("search-input").value||"").trim();
  if(!q) return alert("Type a player name first.");
  const resultDiv = document.getElementById("search-result");
  resultDiv.innerHTML = "";

  const found = findPlayerByNameOrAlias(q);
  if(found){
    const p = found.player;
    const card = document.createElement("div");
    card.className = "mini-card";
    const nameMClink = (p.type && p.type.toLowerCase()==="premium") ? `<div><a class="namemc" href="https://namemc.com/profile/${encodeURIComponent(p.name)}" target="_blank">NameMC</a></div>` : "";
    const aliasNote = (found.type==="alias") ? `<div class="alias-note">Searched an old name. Current IGN: ${p.name}</div>` : "";
    card.innerHTML = `
      <img class="skin" src="${p.skin || getHeadURL(p.name,p.type,64)}" alt="${p.name}">
      <div class="region">${p.region}</div>
      <div class="name">${p.name}</div>
      ${nameMClink}
      <div class="tier-box"><img src="https://mctiers.com/tier_icons/nethop.svg" alt="helmet"><div class="tier-text">${p.tier}</div></div>
      ${aliasNote}
    `;
    resultDiv.appendChild(card);
    return;
  }

  // not in DB: check Mojang
  try{
    const res = await fetch(`https://api.mojang.com/users/profiles/minecraft/${encodeURIComponent(q)}`);
    if(res.status === 200){
      if(confirm(`"${q}" is a valid/current Minecraft IGN but not on the leaderboard. Add now?`)){
        addPlayerPreFill(q);
      } else {
        alert("Not added. Use Add/Update to add manually.");
      }
    } else {
      alert(`"${q}" not found on Mojang and not in leaderboard. Add as alias via Add/Update if it's an old username.`);
    }
  }catch(e){
    console.warn("Mojang check failed", e);
    alert("Could not reach Mojang API. Add manually via Add/Update if needed.");
  }
}

function addPlayerPreFill(ign){
  if(!ign) return;
  const ok = confirm(`Add ${ign} to leaderboard?`);
  if(!ok) return;
  const tier = prompt("Tier (HT1.. / RHT..):","HT1") || "HT1";
  const region = prompt("Region (AS, EU, ME, AU, NA):","NA").toUpperCase();
  const type = prompt("Account type (premium/crack):","premium").toLowerCase();
  const newPlayer = { name: ign, aliases:[], tier, region, type, skin: type==="premium"?getHeadURL(ign,"premium",32):getHeadURL("Steve","crack",32) };
  players.push(newPlayer); savePlayers(); render(); alert("Added.");
}
</script>
</body>
</html>
